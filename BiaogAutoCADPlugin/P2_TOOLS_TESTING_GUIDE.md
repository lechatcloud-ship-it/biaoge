# P2工具测试指南

**版本**: v1.1.0
**测试日期**: 2025-11-17
**新增工具**: 11个

---

## 测试环境要求

- AutoCAD 2018-2024 (任一版本)
- .NET Framework 4.8
- 标哥AutoCAD插件 v1.1.0+
- 阿里云百炼API密钥

---

## 视图工具测试 (3个)

### 测试1: zoom_extents - 全图显示

**测试步骤**:
1. 打开AutoCAD,加载插件
2. 绘制一些实体(可以使用AI绘制)
3. 缩放到某个局部区域
4. 在AI助手输入: "全图显示"

**预期结果**:
- AI调用`zoom_extents`工具
- 视图自动缩放显示所有实体

**测试命令**:
```
AI: 帮我绘制一个1000x1000的矩形和一个半径500的圆
AI: 现在全图显示
```

---

### 测试2: zoom_window - 窗口缩放

**测试步骤**:
1. 在AI助手输入: "缩放到坐标(0,0)到(500,500)的区域"

**预期结果**:
- AI调用`zoom_window`工具,参数为corner1=[0,0,0], corner2=[500,500,0]
- 视图缩放到指定窗口

**测试命令**:
```
AI: 缩放到坐标(0,0)到(1000,1000)的区域
```

---

### 测试3: pan_view - 平移视图

**测试步骤**:
1. 在AI助手输入: "把视图向右平移500mm"

**预期结果**:
- AI调用`pan_view`工具,参数为displacement=[500,0,0]
- 视图向右平移

**测试命令**:
```
AI: 把视图向右平移1000mm
AI: 把视图向上平移500mm
```

---

## 文件工具测试 (2个)

### 测试4: save_drawing - 保存图纸

**测试步骤**:
1. 修改图纸内容
2. 在AI助手输入: "保存图纸"

**预期结果**:
- AI调用`save_drawing`工具
- 图纸保存成功

**测试命令**:
```
AI: 保存图纸
AI: 把图纸另存为C:/test/test.dwg (需要提前创建C:/test目录)
```

---

### 测试5: export_to_pdf - 导出PDF

**测试步骤**:
1. 在AI助手输入: "导出PDF到C:/test/output.pdf"

**预期结果**:
- AI调用`export_to_pdf`工具
- PDF文件生成成功

**测试命令**:
```
AI: 导出PDF到C:/test/建筑图纸.pdf
```

---

## 高级修改工具测试 (6个)

### 测试6: mirror_entity - 镜像实体

**测试步骤**:
1. 绘制一个矩形: draw_rectangle({corner1: [0,0], corner2: [100,100]})
2. 获取矩形ID (通过list_entities)
3. 在AI助手输入: "把这个矩形沿Y轴镜像"

**预期结果**:
- AI调用`mirror_entity`工具
- 创建镜像副本

**测试命令**:
```
AI: 在(0,0)到(100,100)画一个矩形
AI: 把这个矩形沿Y轴镜像复制
AI: 再沿X轴镜像一次
```

---

### 测试7: offset_entity - 偏移实体

**测试步骤**:
1. 绘制一个圆: draw_circle({center: [0,0,0], radius: 100})
2. 在AI助手输入: "把这个圆向外偏移20mm"

**预期结果**:
- AI调用`offset_entity`工具,参数distance=20
- 创建偏移后的圆(半径120)

**测试命令**:
```
AI: 在原点画一个半径100的圆
AI: 把这个圆向外偏移50mm
AI: 再向外偏移30mm
```

---

### 测试8: trim_entity - 修剪实体

**测试步骤**:
1. 绘制两条相交的线
2. 在AI助手输入: "修剪这两条线"

**预期结果**:
- AI调用`trim_entity`工具
- 提示需要交互式操作

**测试命令**:
```
AI: 画两条相交的线
AI: 修剪这两条线 (AI会提示交互式操作)
```

---

### 测试9: extend_entity - 延伸实体

**测试步骤**:
1. 绘制一条线和一条边界线
2. 在AI助手输入: "延伸这条线到边界"

**预期结果**:
- AI调用`extend_entity`工具
- 提示需要交互式操作

**测试命令**:
```
AI: 延伸这条线到边界 (AI会提示交互式操作)
```

---

### 测试10: fillet_entity - 圆角

**测试步骤**:
1. 绘制两条垂直相交的线
2. 在AI助手输入: "在这两条线之间创建半径20的圆角"

**预期结果**:
- AI调用`fillet_entity`工具,参数radius=20
- 创建圆角

**测试命令**:
```
AI: 画两条垂直相交的线
AI: 在这两条线之间创建半径50的圆角
```

---

### 测试11: chamfer_entity - 倒角

**测试步骤**:
1. 绘制两条垂直相交的线
2. 在AI助手输入: "在这两条线之间创建倒角,距离都是30mm"

**预期结果**:
- AI调用`chamfer_entity`工具,参数distance1=30, distance2=30
- 创建倒角

**测试命令**:
```
AI: 画两条垂直相交的线
AI: 在这两条线之间创建倒角,距离1=40mm,距离2=60mm
```

---

## 综合测试场景

### 场景1: 完整的绘图工作流

```
测试命令序列:
1. AI: 画一个2000x1500的矩形房间
2. AI: 在(500,500)画一个直径600的圆柱
3. AI: 把这个圆柱向外偏移100mm
4. AI: 全图显示
5. AI: 保存图纸
6. AI: 导出PDF到C:/test/房间设计.pdf
```

**预期工具调用序列**:
1. draw_rectangle
2. draw_circle
3. offset_entity
4. zoom_extents
5. save_drawing
6. export_to_pdf

---

### 场景2: 复杂的修改操作

```
测试命令序列:
1. AI: 在(0,0)到(100,100)画一个矩形
2. AI: 沿Y轴镜像这个矩形
3. AI: 再沿X轴镜像
4. AI: 把所有矩形向右移动200mm
5. AI: 全图显示
```

**预期工具调用序列**:
1. draw_rectangle
2. list_entities (AI自动查询实体ID)
3. mirror_entity (Y轴)
4. mirror_entity (X轴)
5. move_entity
6. zoom_extents

---

## 测试检查清单

### 功能测试
- [ ] 视图工具: zoom_extents
- [ ] 视图工具: zoom_window
- [ ] 视图工具: pan_view
- [ ] 文件工具: save_drawing
- [ ] 文件工具: export_to_pdf
- [ ] 高级修改: mirror_entity
- [ ] 高级修改: offset_entity
- [ ] 高级修改: trim_entity
- [ ] 高级修改: extend_entity
- [ ] 高级修改: fillet_entity
- [ ] 高级修改: chamfer_entity

### 性能测试
- [ ] 工具调用延迟 < 2秒
- [ ] AI理解意图准确率 > 90%
- [ ] 批量操作稳定性

### 错误处理
- [ ] 无效参数提示
- [ ] 实体ID不存在提示
- [ ] 文件路径错误提示
- [ ] AutoCAD命令失败提示

---

## 已知限制

1. **TRIM和EXTEND**: 需要AutoCAD交互式操作,当前实现仅提供提示
2. **FILLET和CHAMFER**: 使用AutoCAD命令,可能需要用户确认
3. **PDF导出**: 依赖AutoCAD内置导出功能,可能需要配置PDF打印机

---

## 故障排除

### 问题1: 工具调用失败
**原因**: API密钥未配置或过期
**解决**: 运行`BIAOGE_SETTINGS`命令检查配置

### 问题2: 视图工具无效果
**原因**: AutoCAD命令执行失败
**解决**: 检查AutoCAD日志,确保没有命令冲突

### 问题3: 文件保存失败
**原因**: 文件路径权限不足或路径不存在
**解决**: 使用有效的文件路径,确保目录存在

---

## 测试报告模板

```
测试日期: _______
测试环境: AutoCAD _____ / .NET Framework _____
插件版本: _______

测试结果:
- 通过: ___/11
- 失败: ___/11
- 跳过: ___/11

失败详情:
1. 工具名称: _______
   失败原因: _______
   错误信息: _______

综合评价:
- 功能完整性: ☐优秀 ☐良好 ☐一般 ☐需改进
- 性能表现: ☐优秀 ☐良好 ☐一般 ☐需改进
- 用户体验: ☐优秀 ☐良好 ☐一般 ☐需改进

测试人员: _______
```

---

**测试完成后请更新AGENT_TOOLS_CATALOG.md文档**
