# 标哥AutoCAD插件 - 完整产品设计

## 产品定位
专为建筑工程设计师打造的**智能CAD助手**，集成AI翻译、智能问答、构件识别于一体的AutoCAD插件。

---

## 核心设计理念

### 1. **极致的用户体验**
- ✅ 多种操作方式：命令行、快捷键、右键菜单、Ribbon工具栏
- ✅ 操作符合AutoCAD用户习惯
- ✅ 实时反馈，流程清晰
- ✅ 可自定义配置（快捷键、模型、语言）

### 2. **智能化**
- ✅ AI Agent自动选择最优模型
- ✅ 智能缓存，避免重复翻译
- ✅ 上下文感知（当前图层、选择集、绘图状态）

### 3. **高效率**
- ✅ 批量操作（全图、框选、图层、块）
- ✅ 快捷键一键触发
- ✅ 后台处理不阻塞UI
- ✅ 预览功能避免误操作

---

## 完整功能列表

### 一、翻译功能

#### 1.1 全图翻译 ✅ (已实现)
**命令**: `BIAOGE_TRANSLATE`
**快捷键**: `Ctrl+T` (默认)
**描述**: 打开翻译面板，选择目标语言，翻译整个图纸的所有文本

**使用场景**:
- 接手中文图纸，需要翻译为英文给国外客户
- 导入日文图纸，需要翻译为中文
- 批量翻译多张图纸

**功能增强**:
- [ ] 支持批处理多个DWG文件
- [ ] 翻译前预览（显示将翻译的文本数量）
- [ ] 翻译后对比查看（原文/译文切换）

---

#### 1.2 框选翻译 ⏳ (待实现 - 最高优先级)
**命令**: `BIAOGE_TRANSLATE_SELECTED`
**快捷键**: `Ctrl+Shift+T` (默认)
**右键菜单**: 选中文本 → 右键 → "翻译选中文本"

**工作流程**:
1. 用户使用AutoCAD选择工具框选文本实体
2. 执行命令或右键选择"翻译选中文本"
3. 弹出快速语言选择对话框（小窗口，不遮挡视图）
4. 点击确认，仅翻译选中的文本
5. 实时显示翻译进度

**使用场景**:
- 只需要翻译图纸的一部分区域（比如某个房间的标注）
- 测试翻译效果，先翻译小范围查看质量
- 选择性翻译，保留部分原文（如施工说明）

**技术实现**:
```csharp
// 使用Editor.GetSelection()获取选择集
var selection = ed.GetSelection();
if (selection.Status != PromptStatus.OK) return;

// 过滤文本实体
var textEntityIds = selection.Value.GetObjectIds()
    .Where(id => IsTextEntity(id))
    .ToList();

// 批量翻译
await TranslateSelectedEntities(textEntityIds, targetLanguage);
```

---

#### 1.3 单文本快速翻译 ⏳ (待实现)
**命令**: `BIAOGE_TRANSLATE_SINGLE`
**快捷键**: `Ctrl+Alt+T` (默认)
**右键菜单**: 双击文本 → 右键 → "快速翻译"

**工作流程**:
1. 双击或选中单个文本实体
2. 执行命令或右键"快速翻译"
3. 弹出小窗口显示：原文 → 译文
4. 点击"应用"或"取消"

**使用场景**:
- 快速修正单个翻译错误
- 查看某个专业术语的翻译
- 对比不同语言的翻译效果

**UI设计**:
```
┌─────────────────────────────┐
│  快速翻译                   │
├─────────────────────────────┤
│  原文: 建筑外墙              │
│  译文: Building Exterior Wall │
│                              │
│  目标语言: [英语 ▼]          │
│                              │
│  [应用] [取消] [预览其他语言] │
└─────────────────────────────┘
```

---

#### 1.4 图层翻译 ⏳ (待实现)
**命令**: `BIAOGE_TRANSLATE_LAYER`
**快捷键**: `Ctrl+L` (默认)

**工作流程**:
1. 执行命令
2. 弹出图层选择对话框（多选）
3. 选择要翻译的图层
4. 仅翻译选中图层上的所有文本

**使用场景**:
- 只翻译"结构"图层，不翻译"建筑"图层
- 分阶段翻译，避免一次性翻译太多
- 不同图层使用不同的术语库

---

#### 1.5 块内翻译 ⏳ (待实现)
**命令**: `BIAOGE_TRANSLATE_BLOCK`

**工作流程**:
1. 选择一个块引用
2. 翻译该块定义内的所有文本
3. 所有引用该块的实例同步更新

**使用场景**:
- 翻译标题栏块
- 翻译图例块
- 翻译标准构件块

---

#### 1.6 翻译预览 ⏳ (待实现)
**命令**: `BIAOGE_TRANSLATE_PREVIEW`

**功能**:
- 不实际修改图纸
- 在浮动窗口显示翻译前后对比
- 用户确认后才应用

**使用场景**:
- 担心翻译质量，先预览
- 查看哪些文本会被翻译
- 检查是否有遗漏的文本

---

### 二、AI助手功能

#### 2.1 标哥AI助手 ✅ (已实现)
**命令**: `BIAOGE_AI`
**快捷键**: `F12` (默认) - **建议设置为F12，方便快速呼出**
**右键菜单**: 选中实体 → 右键 → "问AI关于此对象"

**核心能力**:
- 智能Agent架构（qwen3-max-preview）
- 自动调度专用模型（翻译/代码/视觉）
- 支持深度思考模式
- 流式输出，实时反馈

**使用场景**:
- "帮我翻译'外墙'为英文" → 自动调用qwen-mt-flash
- "将所有的'C30'修改为'C35'" → 自动修改DWG
- "识别图纸中的梁构件" → 自动调用qwen3-vl-flash
- "这张图纸有哪些图层？" → 直接查询DrawingContext

**功能增强**:
- [ ] 浮动面板（不挡住绘图区域）
- [ ] 历史记录（保存对话历史）
- [ ] 语音输入（集成qwen3-asr-flash）
- [ ] 快捷回复（预设常用问题）

---

#### 2.2 语音输入 ⏳ (待实现)
**命令**: `BIAOGE_VOICE`
**快捷键**: `Ctrl+Space` (默认，类似微信语音)

**工作流程**:
1. 按住`Ctrl+Space`开始录音
2. 释放按键结束录音
3. 自动调用qwen3-asr-flash识别
4. 将识别文本发送给AI助手

**使用场景**:
- 解放双手，边看图纸边语音问AI
- 快速输入复杂指令
- 适合移动办公（触控板不方便打字）

---

#### 2.3 智能问答面板 ⏳ (待实现)
**命令**: `BIAOGE_QA_PANEL`

**UI设计**:
```
┌─────────────────────────────────┐
│  标哥AI助手 (qwen3-max-preview) │
├─────────────────────────────────┤
│  🎯 快捷问题:                   │
│  • 统计构件数量                  │
│  • 导出工程量清单                │
│  • 查看图层信息                  │
│  • 翻译整个图纸                  │
├─────────────────────────────────┤
│  💬 对话历史:                   │
│  [滚动区域显示对话]              │
├─────────────────────────────────┤
│  🎤 [语音] 输入您的问题...  [发送] │
└─────────────────────────────────┘
```

---

### 三、快捷键系统

#### 3.1 默认快捷键映射

| 功能 | 默认快捷键 | 说明 |
|-----|-----------|------|
| **翻译** |||
| 全图翻译 | `Ctrl+T` | Translate |
| 框选翻译 | `Ctrl+Shift+T` | Translate Selected |
| 单文本翻译 | `Ctrl+Alt+T` | Translate Single |
| 图层翻译 | `Ctrl+L` | Layer Translate |
| 翻译预览 | `Ctrl+P` | Preview |
| **AI助手** |||
| 启动AI助手 | `F12` | 快速呼出 |
| 语音输入 | `Ctrl+Space` | 按住说话 |
| 深度思考 | `Ctrl+Shift+D` | Deep Thinking |
| 清除历史 | `Ctrl+Shift+C` | Clear History |
| **算量** |||
| 识别构件 | `Ctrl+Q` | Quick Recognize |
| 导出Excel | `Ctrl+E` | Export |
| 快速统计 | `Ctrl+Shift+Q` | Quick Count |
| **工具** |||
| 设置 | `Ctrl+Shift+S` | Settings |
| 帮助 | `F1` | Help |

#### 3.2 自定义快捷键

**命令**: `BIAOGE_KEYBINDINGS`

**配置文件**: `%USERPROFILE%\.biaoge\keybindings.json`

```json
{
  "Keybindings": {
    "TranslateAll": "Ctrl+T",
    "TranslateSelected": "Ctrl+Shift+T",
    "AIAssistant": "F12",
    "VoiceInput": "Ctrl+Space",
    "QuickRecognize": "Ctrl+Q",
    "ExportExcel": "Ctrl+E",
    "Settings": "Ctrl+Shift+S"
  }
}
```

**UI设计**:
```
┌─────────────────────────────────┐
│  快捷键设置                     │
├─────────────────────────────────┤
│  功能            快捷键          │
│  全图翻译        [Ctrl+T    ]  │
│  框选翻译        [Ctrl+Shift+T] │
│  AI助手          [F12       ]  │
│  语音输入        [Ctrl+Space]  │
│                                 │
│  [恢复默认] [保存] [取消]        │
└─────────────────────────────────┘
```

---

### 四、右键上下文菜单

#### 4.1 选中文本实体时
```
┌─────────────────────────┐
│ 📝 翻译选中文本         │
│ 🤖 问AI关于此文本       │
│ ✏️ 修改文本内容         │
│ 📋 复制翻译结果         │
│ ─────────────────────── │
│ AutoCAD标准菜单...      │
└─────────────────────────┘
```

#### 4.2 未选中任何对象时
```
┌─────────────────────────┐
│ 🌐 标哥翻译             │
│   • 全图翻译            │
│   • 框选翻译            │
│   • 图层翻译            │
│ ─────────────────────── │
│ 🤖 启动AI助手 (F12)     │
│ 📊 识别构件             │
│ ⚙️ 设置                │
│ ─────────────────────── │
│ AutoCAD标准菜单...      │
└─────────────────────────┘
```

**技术实现**:
```csharp
// 在PluginApplication.cs中注册上下文菜单
public void Initialize()
{
    // 注册上下文菜单
    var contextMenu = new ContextMenuExtension();
    contextMenu.Title = "标哥工具";
    contextMenu.MenuItems.Add(new MenuItem("翻译选中文本", OnTranslateSelected));
    contextMenu.MenuItems.Add(new MenuItem("问AI关于此对象", OnAskAI));

    Application.AddContextMenuExtension(contextMenu);
}
```

---

### 五、Ribbon工具栏界面

#### 5.1 Ribbon布局设计

**标哥 (Biaoge)** 选项卡

```
┌──────────────────────────────────────────────────────────┐
│  翻译 (Translation)      AI助手 (AI)      算量 (Quantity)  │
├──────────────────────────────────────────────────────────┤
│  [🌐全图翻译]           [🤖启动AI]        [📊识别构件]    │
│  [📝框选翻译]           [🎤语音输入]      [📈导出Excel]   │
│  [📄单文本]             [🧠深度思考]      [🔢快速统计]    │
│  [📂图层翻译]           [🗑️清除历史]                      │
│  [👁️预览]                                                │
│                                                          │
│  语言: [简体中文 ▼]                                      │
├──────────────────────────────────────────────────────────┤
│  工具 (Tools)                                            │
│  [⚙️设置] [❓帮助] [ℹ️关于] [📝日志]                      │
└──────────────────────────────────────────────────────────┘
```

#### 5.2 Ribbon实现

**文件**: `UI/BiaogRibbonTab.cs`

```csharp
public class BiaogRibbonTab
{
    public static void CreateRibbon()
    {
        // 创建Ribbon选项卡
        var ribbonControl = ComponentManager.Ribbon;
        var tab = new RibbonTab();
        tab.Title = "标哥";
        tab.Id = "BIAOGE_TAB";

        // 翻译面板
        var translationPanel = new RibbonPanel();
        translationPanel.Source = new RibbonPanelSource();
        translationPanel.Source.Title = "翻译";

        // 添加按钮
        var translateAllButton = new RibbonButton();
        translateAllButton.Text = "全图翻译";
        translateAllButton.CommandParameter = "BIAOGE_TRANSLATE";
        translateAllButton.LargeImage = LoadImage("translate_all.png");

        // ... 添加更多按钮

        tab.Panels.Add(translationPanel);
        ribbonControl.Tabs.Add(tab);
    }
}
```

---

### 六、高级功能

#### 6.1 批量处理
**命令**: `BIAOGE_BATCH`

**功能**:
- 批量翻译多个DWG文件
- 批量识别构件并导出Excel
- 批量应用设置

#### 6.2 翻译记忆库
**功能**:
- 保存用户自定义的术语对照
- 优先使用术语库，确保一致性
- 支持导入/导出术语库

**配置文件**: `%USERPROFILE%\.biaoge\translation_memory.json`

```json
{
  "TranslationMemory": {
    "zh-CN": {
      "建筑外墙": "Building Exterior Wall",
      "C30混凝土": "C30 Concrete",
      "钢筋": "Reinforcement"
    }
  }
}
```

#### 6.3 翻译质量评估
**功能**:
- 翻译后自动评估质量
- 标注可能有误的翻译（低置信度）
- 允许用户反馈和纠正

#### 6.4 协作功能
**功能**:
- 分享翻译配置给团队
- 同步术语库
- 团队共享AI对话历史

---

## 技术实现优先级

### 阶段1: 核心体验优化 (当前)
1. ✅ Agent架构（已完成）
2. ⏳ 框选翻译（最高优先级）
3. ⏳ 快捷键系统
4. ⏳ 右键菜单集成

### 阶段2: 高级交互 (下一阶段)
5. ⏳ Ribbon工具栏
6. ⏳ 图层翻译
7. ⏳ 单文本快速翻译
8. ⏳ 翻译预览

### 阶段3: 智能化增强 (未来)
9. ⏳ 语音输入
10. ⏳ 翻译记忆库
11. ⏳ 批量处理
12. ⏳ 质量评估

---

## 用户体验目标

### 新手用户 (5分钟上手)
1. 安装插件 → 输入API密钥
2. 看到Ribbon工具栏 → 点击"全图翻译"
3. 选择语言 → 点击"翻译" → 完成

### 高级用户 (快捷键流)
1. 打开图纸
2. `Ctrl+T` → 全图翻译
3. `F12` → 问AI："统计构件数量"
4. `Ctrl+E` → 导出Excel
5. 完成

### 设计师日常工作流
```
上午: 接收日文图纸
  → Ctrl+T 全图翻译为中文
  → F12 问AI："这张图纸的建筑面积是多少？"

下午: 修改设计
  → 框选部分区域
  → Ctrl+Shift+T 翻译为英文给客户
  → F12 "将所有C30改为C35"

晚上: 出工程量清单
  → Ctrl+Q 识别构件
  → Ctrl+E 导出Excel
  → 发送给造价部门
```

---

## 性能指标

- **启动速度**: < 2秒（插件加载）
- **翻译速度**: 100条文本 < 10秒（含缓存）
- **AI响应**: < 3秒（首次响应）
- **内存占用**: < 200MB（正常使用）
- **缓存命中率**: > 90%（重复项目）

---

## 竞争优势

1. **100%准确的DWG读取** - 使用AutoCAD官方API
2. **智能Agent架构** - 一个助手，多种能力
3. **极致的操作体验** - 快捷键+右键+Ribbon
4. **低成本** - 使用Flash系列模型，极低成本
5. **无缝集成** - 完全融入AutoCAD工作流

---

## 下一步行动

按优先级实现:

1. **框选翻译** (1小时) - 用户最需要的功能
2. **快捷键系统** (30分钟) - 大幅提升效率
3. **右键菜单** (30分钟) - 符合操作习惯
4. **Ribbon工具栏** (1小时) - 可视化操作
5. **其他高级功能** (按需实现)

---

**产品理念**: 让AI成为设计师的**智能副手**，而不仅仅是一个翻译工具。
