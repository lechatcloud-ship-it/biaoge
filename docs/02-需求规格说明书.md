# DWG智能翻译算量系统 - 需求规格说明书

## 文档信息
- **项目名称**: DWG智能翻译算量系统
- **文档版本**: v1.0
- **创建日期**: 2025-11-07
- **最后更新**: 2025-11-07
- **编写人**: 系统架构师
- **审核人**: 产品经理

---

## 1. 引言

### 1.1 编写目的
本文档详细描述DWG智能翻译算量系统的功能需求、性能需求、界面需求等，作为系统设计、开发、测试的依据。

### 1.2 项目背景
随着建筑工程行业的国际化发展，工程公司在海外项目中经常需要处理不同语言的CAD图纸。传统的人工翻译效率低、成本高、容易出错。同时，工程量计算是一项繁琐且容易出错的工作。

本系统旨在通过AI技术自动化完成图纸翻译和算量工作，提升工作效率，降低人力成本。

### 1.3 目标用户
- **主要用户**: 建筑设计师、工程造价师、项目管理人员
- **次要用户**: 施工单位技术人员、监理工程师
- **用户特征**:
  - 熟悉CAD软件操作
  - 对工程图纸有基本理解
  - 对翻译和算量有实际需求
  - 计算机操作能力：中等及以上

### 1.4 术语定义

| 术语 | 定义 |
|------|------|
| DWG | AutoCAD图形文件格式，是CAD行业标准格式 |
| DXF | AutoCAD数据交换文件格式，是DWG的文本表示形式 |
| 实体 | CAD图纸中的基本图形元素（线、圆、文本等） |
| 图层 | CAD图纸的组织结构，用于分组管理实体 |
| 算量 | 工程量计算，统计建筑材料的数量、长度、面积等 |
| 百炼 | 阿里云的大模型服务平台 |
| OCR | 光学字符识别，用于从图像中提取文字 |

---

## 2. 功能需求

### 2.1 图纸管理模块

#### FR-01: 图纸导入
**优先级**: P0 (必须)

**需求描述**:
用户能够导入本地的DWG/DXF格式图纸文件。

**输入**:
- 文件路径：本地文件系统中的DWG/DXF文件
- 支持格式：DWG (R13-R2024)、DXF (R13-R2024)

**处理过程**:
1. 用户点击"打开文件"按钮或拖拽文件到窗口
2. 系统弹出文件选择对话框（支持多选）
3. 系统验证文件格式和版本
4. 系统解析文件结构
5. 系统在界面上显示图纸预览

**输出**:
- 图纸预览窗口显示图纸内容
- 左侧面板显示图层列表
- 状态栏显示图纸信息（版本、实体数量等）

**异常处理**:
- 文件不存在：提示"文件未找到"
- 格式不支持：提示"不支持的文件格式，请使用DWG/DXF文件"
- 文件损坏：提示"文件已损坏，无法打开"
- 版本过旧：提示"不支持的DWG版本（< R13）"

**验收标准**:
- 能够成功打开R2018版本的DWG文件（<10MB）在3秒内
- 能够正确显示所有图层和实体
- 错误提示准确且友好

---

#### FR-02: 图纸预览
**优先级**: P0 (必须)

**需求描述**:
用户能够在软件中预览图纸内容，支持缩放、平移、图层控制等操作。

**功能点**:
1. **缩放功能**:
   - 鼠标滚轮缩放
   - 缩放按钮（+/-）
   - 缩放比例显示（10% - 500%）
   - 适应窗口大小

2. **平移功能**:
   - 鼠标拖拽平移
   - 方向键平移
   - 平移速度可调

3. **图层控制**:
   - 图层列表显示
   - 单个图层显示/隐藏
   - 图层颜色显示
   - 图层锁定/解锁

4. **测量工具**:
   - 距离测量
   - 面积测量
   - 角度测量

**界面要求**:
```
┌─────────────────────────────────────────────────────────┐
│  文件(F)  编辑(E)  视图(V)  工具(T)  帮助(H)          │
├─────────────────────────────────────────────────────────┤
│  [图标工具栏: 打开 保存 缩放+ 缩放- 适应 测量...]      │
├─────┬───────────────────────────────────────┬───────────┤
│图层 │                                       │   属性    │
│列表 │          图纸显示区域                 │   面板    │
│     │                                       │           │
│☑ 0  │                                       │  实体:    │
│☑ 墙体│           [CAD Drawing]              │  类型: LINE│
│☐ 门窗│                                       │  图层: 墙体│
│☑ 标注│                                       │  颜色: #000│
│     │                                       │           │
├─────┴───────────────────────────────────────┴───────────┤
│  比例: 100%  |  坐标: (0, 0)  |  实体数: 1234         │
└─────────────────────────────────────────────────────────┘
```

**验收标准**:
- 缩放操作流畅，无明显卡顿（60 FPS）
- 图层开关即时生效（<100ms）
- 测量结果精确（误差<0.1%）

---

#### FR-03: 图纸保存
**优先级**: P0 (必须)

**需求描述**:
用户能够保存翻译/修改后的图纸。

**功能点**:
1. **另存为**: 保存到新文件
2. **覆盖保存**: 覆盖原文件（需确认）
3. **格式选择**: DWG、DXF、PDF、SVG
4. **版本选择**: AutoCAD版本（R2018/R2021/R2024）

**输出格式规格**:
- **DWG**: 保持原有图层结构、样式、块定义
- **DXF**: ASCII格式，方便文本编辑
- **PDF**: 矢量格式，高清打印
- **SVG**: Web友好，可在浏览器查看

**验收标准**:
- 保存后的文件能在AutoCAD中正常打开
- 翻译后的文本正确显示（无乱码）
- 文件大小合理（不超过原文件的150%）

---

### 2.2 翻译功能模块

#### FR-04: 文本提取
**优先级**: P0 (必须)

**需求描述**:
系统自动提取图纸中的所有文本内容（TEXT、MTEXT、标注等）。

**提取范围**:
- TEXT实体（单行文本）
- MTEXT实体（多行文本）
- DIMENSION实体中的标注文本
- LEADER实体中的引线文本
- 块（BLOCK）中的文本属性
- 表格（TABLE）中的单元格文本

**输出**:
- 文本列表，包含：
  - 原始文本
  - 实体类型
  - 图层名称
  - 坐标位置
  - 字体样式
  - 高度/宽度

**排除规则**:
- 纯数字（如坐标标注）
- 纯符号（如 %%c、%%d）
- 重复文本（自动去重）

**验收标准**:
- 提取率 > 99%（不遗漏可见文本）
- 准确识别文本实体类型
- 正确保留文本格式信息

---

#### FR-05: 智能翻译
**优先级**: P0 (必须)

**需求描述**:
调用阿里云百炼大模型API，将提取的文本翻译成目标语言。

**支持语言**:
- 中文 ↔ 英文
- 中文 ↔ 日文
- 中文 ↔ 韩文
- 英文 ↔ 日文
- （可扩展至50+语言）

**翻译策略**:
1. **批量翻译**: 将多条文本合并为一次请求（提升效率）
2. **上下文感知**: 根据图层、周边文本推断术语含义
3. **术语库支持**: 使用专业建筑术语库
4. **格式保留**: 保留数字、单位、符号
5. **缓存机制**: 相同文本使用缓存，避免重复翻译

**翻译质量要求**:
- **准确性**: 专业术语翻译准确率 > 95%
- **一致性**: 相同术语在全图保持一致翻译
- **格式**: 保留原文的换行、缩进等格式
- **符号**: 正确处理特殊符号（%%c代表直径Ø）

**示例**:

| 原文（中文） | 翻译（英文） | 说明 |
|--------------|--------------|------|
| 承重墙 | Load-bearing Wall | 建筑术语 |
| 厚度200mm | Thickness 200mm | 保留单位 |
| Ø16@200 | Ø16@200 | 钢筋符号不翻译 |
| 一层平面图 | First Floor Plan | 建筑图纸标题 |

**用户交互**:
```
┌─────────────────────────────────────────┐
│          翻译设置                       │
├─────────────────────────────────────────┤
│  源语言:  [中文简体 ▼]                 │
│  目标语言: [英文     ▼]                 │
│                                         │
│  ☑ 使用专业术语库                      │
│  ☑ 保留数字和单位                      │
│  ☑ 智能识别专有名词（不翻译）          │
│                                         │
│  模型选择: ● qwen-plus  ○ qwen-max    │
│  (qwen-max精度更高但速度较慢)          │
│                                         │
│        [开始翻译]  [取消]              │
└─────────────────────────────────────────┘
```

**进度显示**:
- 实时显示翻译进度（百分比）
- 显示已翻译/总数量
- 预估剩余时间
- 支持取消操作

**验收标准**:
- 翻译1000条文本在30秒内完成
- 专业术语准确率 > 95%
- 支持中断和恢复
- 错误重试机制（最多3次）

---

#### FR-06: 翻译预览与编辑
**优先级**: P1 (重要)

**需求描述**:
用户能够预览翻译结果，并手动修改不满意的翻译。

**功能点**:
1. **对照显示**: 左右分栏显示原文和译文
2. **实时编辑**: 双击译文可直接修改
3. **搜索过滤**: 按关键字过滤文本
4. **批量替换**: 批量替换相同术语
5. **撤销/重做**: 支持操作历史

**界面设计**:
```
┌──────────────────────────────────────────────────────┐
│  翻译结果预览                          [搜索: ___]   │
├─────┬──────────────────┬──────────────────┬──────────┤
│序号 │  原文(中文)      │  译文(English)   │  图层    │
├─────┼──────────────────┼──────────────────┼──────────┤
│  1  │  承重墙          │  Load-bearing Wall│  墙体   │
│  2  │  厚度200mm       │  Thickness 200mm │  标注   │
│  3  │  一层平面图      │  1F Floor Plan   │  标题   │ *
│  4  │  卫生间          │  Bathroom        │  房间   │
├─────┴──────────────────┴──────────────────┴──────────┤
│  * 已修改    总计: 125  已翻译: 125  已修改: 1       │
│                                                       │
│  [应用到图纸]  [导出Excel]  [恢复原文]  [关闭]     │
└───────────────────────────────────────────────────────┘
```

**验收标准**:
- 编辑操作即时响应（<50ms）
- 支持导出Excel格式的翻译对照表
- 修改后能正确应用到图纸

---

### 2.3 算量功能模块

#### FR-07: 自动识别构件
**优先级**: P1 (重要)

**需求描述**:
系统基于图层名称、实体类型、几何特征等信息，自动识别建筑构件。

**识别范围**:
- **结构构件**: 墙体、柱、梁、板、基础
- **建筑构件**: 门、窗、楼梯、栏杆
- **装修构件**: 地面、吊顶、墙面
- **设备构件**: 管道、电气、暖通

**识别方法**:
1. **规则匹配**: 根据图层名称（如"墙体"、"WALL"）
2. **AI识别**: 使用大模型分析实体组合
3. **几何判断**: 根据封闭性、尺寸等特征

**输出**:
```typescript
{
  "component_id": "C001",
  "type": "墙体",
  "subtype": "承重墙",
  "layer": "墙体",
  "entities": ["E123", "E124", "E125"],
  "properties": {
    "材质": "混凝土",
    "厚度": "200mm",
    "高度": "3000mm"
  },
  "confidence": 0.95  // 识别置信度
}
```

**验收标准**:
- 主要构件识别准确率 > 90%
- 低置信度项目（<70%）提示人工确认
- 支持用户自定义识别规则

---

#### FR-08: 工程量计算
**优先级**: P0 (必须)

**需求描述**:
根据识别的构件，计算工程量（长度、面积、体积、数量等）。

**计算类型**:

| 构件类型 | 计算项 | 单位 | 计算公式 |
|----------|--------|------|----------|
| 墙体 | 面积 | m² | 长度 × 高度 |
| 墙体 | 体积 | m³ | 长度 × 高度 × 厚度 |
| 门窗 | 面积 | m² | 宽度 × 高度 |
| 门窗 | 数量 | 樘 | 统计个数 |
| 梁 | 长度 | m | 中心线长度 |
| 梁 | 体积 | m³ | 长度 × 截面积 |
| 柱 | 数量 | 根 | 统计个数 |
| 柱 | 体积 | m³ | 高度 × 截面积 × 数量 |
| 板 | 面积 | m² | 平面面积 |
| 板 | 体积 | m³ | 面积 × 厚度 |
| 楼梯 | 面积 | m² | 踏步面积之和 |
| 钢筋 | 长度 | m | 根据标注计算 |
| 钢筋 | 重量 | kg | 长度 × 理论重量 |

**计算规则**:
1. **自动扣除**: 门窗洞口自动扣除墙体面积
2. **搭接处理**: 墙体交接处按中心线计算
3. **损耗系数**: 支持设置损耗率（默认3%）
4. **扣减规则**: 支持自定义扣减规则

**高级功能**:
- **钢筋算量**: 识别钢筋标注，计算钢筋工程量
- **管线算量**: 统计给排水、电气管线长度
- **装修算量**: 计算地面、墙面、吊顶面积

**示例输出**:
```
墙体工程量:
- 砖墙 (240mm):
  * 长度: 125.6m
  * 面积: 376.8m² (扣除门窗后: 342.3m²)
  * 体积: 82.15m³

- 混凝土墙 (200mm):
  * 长度: 68.2m
  * 面积: 204.6m²
  * 体积: 40.92m³
```

**验收标准**:
- 计算结果与手工计算误差 < 2%
- 自动扣减准确率 > 95%
- 支持导出详细计算书

---

#### FR-09: 算量报表
**优先级**: P0 (必须)

**需求描述**:
生成详细的工程量清单报表，支持HTML和Excel格式导出。

**报表内容**:
1. **汇总表**: 按类别汇总工程量
2. **明细表**: 详细列出每个构件的工程量
3. **对比表**: 与标准工程量对比（如有）
4. **图表**: 可视化展示工程量分布

**HTML报表模板**:
```html
<!DOCTYPE html>
<html>
<head>
  <title>工程量清单报表</title>
  <style>
    /* 专业报表样式 */
  </style>
</head>
<body>
  <header>
    <h1>工程量清单报表</h1>
    <div class="project-info">
      <p>项目名称: XXX住宅楼</p>
      <p>图纸文件: 一层平面图.dwg</p>
      <p>生成时间: 2025-11-07 14:30:25</p>
    </div>
  </header>

  <section id="summary">
    <h2>工程量汇总</h2>
    <table>
      <thead>
        <tr>
          <th>类别</th>
          <th>项目</th>
          <th>数量</th>
          <th>单位</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td rowspan="2">墙体</td>
          <td>砖墙</td>
          <td>342.3</td>
          <td>m²</td>
        </tr>
        <tr>
          <td>混凝土墙</td>
          <td>204.6</td>
          <td>m²</td>
        </tr>
        <!-- 更多行... -->
      </tbody>
    </table>
  </section>

  <section id="details">
    <h2>工程量明细</h2>
    <!-- 详细表格 -->
  </section>

  <section id="charts">
    <h2>工程量分布图</h2>
    <canvas id="pieChart"></canvas>
    <canvas id="barChart"></canvas>
  </section>

  <footer>
    <p>由 DWG智能翻译算量系统 v1.0 生成</p>
  </footer>

  <script src="chart.js"></script>
  <script>
    // 图表渲染脚本
  </script>
</body>
</html>
```

**Excel导出格式**:
- Sheet1: 汇总表
- Sheet2: 明细表
- Sheet3: 图层统计
- Sheet4: 原始数据

**报表定制**:
- 支持自定义报表模板（HTML/CSS）
- 支持添加公司Logo和水印
- 支持自定义表头和页脚

**验收标准**:
- HTML报表可直接打印（A4纸）
- Excel报表可在Office 2016+打开
- 报表数据完整准确
- 生成速度 < 5秒

---

### 2.4 系统设置模块

#### FR-10: API配置
**优先级**: P0 (必须)

**需求描述**:
用户能够配置阿里云百炼API密钥和相关参数。

**配置项**:
```
┌─────────────────────────────────────────┐
│          API 配置                       │
├─────────────────────────────────────────┤
│  阿里云百炼API密钥:                     │
│  [sk-xxxxxxxxxxxxxxxxxx]  [测试连接]   │
│                                         │
│  API端点 (可选):                        │
│  [https://dashscope.aliyuncs.com]      │
│                                         │
│  默认模型:                              │
│  ● qwen-plus  ○ qwen-max               │
│                                         │
│  请求超时 (秒): [60   ]                │
│  重试次数:      [3    ]                │
│  并发请求数:    [3    ]                │
│                                         │
│  ☑ 启用翻译缓存 (减少API调用)          │
│  缓存有效期: [7] 天                     │
│                                         │
│        [保存]  [取消]                  │
└─────────────────────────────────────────┘
```

**安全要求**:
- API密钥存储在系统密钥链（macOS Keychain / Windows Credential Manager）
- 配置界面显示密钥为 `sk-***...***` 形式
- 不在日志中记录完整密钥

**验收标准**:
- "测试连接"功能能验证API密钥有效性
- 配置保存后立即生效
- 无效配置给出明确错误提示

---

#### FR-11: 算量规则配置
**优先级**: P1 (重要)

**需求描述**:
用户能够自定义算量规则，适应不同地区的计算标准。

**配置内容**:
1. **构件识别规则**: 图层名称 → 构件类型映射
2. **计算公式**: 自定义计算公式
3. **扣减规则**: 门窗洞口扣减设置
4. **损耗系数**: 不同材料的损耗率
5. **单位换算**: 支持公制/英制单位

**规则文件格式** (YAML):
```yaml
# 算量规则配置文件
version: "1.0"

# 图层识别规则
layer_mapping:
  - pattern: "墙体|WALL|Wall"
    component_type: "墙体"
    properties:
      default_thickness: 200  # mm
      default_height: 3000    # mm

  - pattern: "门窗|DOOR|WINDOW"
    component_type: "门窗"

# 计算规则
calculation_rules:
  墙体:
    - name: "墙体面积"
      formula: "length * height"
      unit: "m²"
      deductions:
        - type: "门窗"
          formula: "door_area + window_area"

    - name: "墙体体积"
      formula: "length * height * thickness"
      unit: "m³"

  门窗:
    - name: "门窗面积"
      formula: "width * height"
      unit: "m²"

    - name: "门窗数量"
      formula: "count"
      unit: "樘"

# 损耗系数
waste_factors:
  砖墙: 0.03    # 3%
  混凝土: 0.02  # 2%
  钢筋: 0.05    # 5%
```

**界面功能**:
- 规则编辑器（语法高亮）
- 规则验证（语法检查）
- 规则导入/导出
- 预设规则库（国标、地方标准）

**验收标准**:
- 支持至少10种预设规则库
- 自定义规则能正确应用
- 错误规则有明确提示

---

#### FR-12: 界面偏好设置
**优先级**: P2 (一般)

**需求描述**:
用户能够自定义界面外观和行为。

**设置项**:
- **语言**: 中文、英文、日文
- **主题**: 浅色、深色、自动（跟随系统）
- **字体大小**: 小、中、大
- **快捷键**: 自定义快捷键绑定
- **默认路径**: 文件打开/保存的默认目录

**验收标准**:
- 设置立即生效（无需重启）
- 设置持久化保存
- 支持恢复默认设置

---

## 3. 非功能需求

### 3.1 性能需求

#### NFR-01: 响应时间
| 操作 | 目标时间 | 可接受时间 |
|------|----------|-----------|
| 打开10MB DWG文件 | < 2秒 | < 5秒 |
| 图层切换 | < 100ms | < 200ms |
| 缩放/平移 | < 16ms (60 FPS) | < 33ms (30 FPS) |
| 翻译100条文本 | < 10秒 | < 20秒 |
| 算量计算 | < 5秒 | < 10秒 |
| 导出报表 | < 3秒 | < 5秒 |

#### NFR-02: 吞吐量
- 支持同时打开最多5个图纸文件
- 单次翻译最多支持10,000条文本
- 算量支持最多50,000个实体

#### NFR-03: 资源占用
- 内存占用: < 500MB（空闲状态）
- 内存占用: < 2GB（满载状态）
- CPU占用: < 30%（平均）
- 磁盘占用: < 200MB（应用本体）

---

### 3.2 可靠性需求

#### NFR-04: 可用性
- 系统正常运行时间 > 99%
- 平均无故障时间(MTBF) > 720小时

#### NFR-05: 容错性
- API调用失败自动重试（最多3次）
- 网络中断后自动恢复
- 文件损坏时给出明确提示
- 应用崩溃后能恢复未保存数据（自动保存草稿）

#### NFR-06: 数据完整性
- 翻译结果100%映射回原实体（不遗漏）
- 算量数据可追溯到源实体
- 导出文件与原文件结构一致

---

### 3.3 可用性需求

#### NFR-07: 易学性
- 新用户30分钟内能完成基本操作（导入、翻译、导出）
- 提供完整的用户手册和视频教程
- 关键功能提供tooltips提示

#### NFR-08: 易用性
- 符合CAD软件用户的操作习惯
- 常用功能不超过3次点击
- 支持键盘快捷键
- 错误提示清晰友好

#### NFR-09: 无障碍性
- 支持键盘导航
- 界面元素有清晰的焦点指示
- 颜色不是唯一的信息传达方式

---

### 3.4 兼容性需求

#### NFR-10: 平台兼容
- Windows 10/11 (64位)
- macOS 11.0+ (Intel & Apple Silicon)
- Linux (Ubuntu 20.04+, Debian 11+, Fedora 35+)

#### NFR-11: 文件格式兼容
- DWG: R13 - R2024
- DXF: R13 - R2024
- 导出格式: DWG (R2018/R2021), DXF, PDF, SVG

#### NFR-12: 第三方软件兼容
- 导出的DWG能在AutoCAD 2018+中正常打开
- 导出的DXF能在LibreCAD、QCAD中打开
- 导出的PDF能在Adobe Reader、浏览器中查看

---

### 3.5 安全性需求

#### NFR-13: 数据安全
- 本地文件不上传到云端（除API调用的文本）
- API密钥加密存储
- 翻译缓存可选择性清除

#### NFR-14: 隐私保护
- 不收集用户个人信息
- 不统计用户文件内容
- 遵守GDPR、中国网络安全法

#### NFR-15: 传输安全
- 所有API调用使用HTTPS
- 证书验证防止中间人攻击

---

### 3.6 可维护性需求

#### NFR-16: 可测试性
- 核心模块单元测试覆盖率 > 80%
- 关键功能有集成测试
- 提供测试数据集

#### NFR-17: 可扩展性
- 模块化设计，便于添加新功能
- 支持插件系统（未来）
- API抽象层，便于切换大模型服务商

#### NFR-18: 可配置性
- 算量规则可配置
- 翻译提示词可自定义
- 界面布局可调整

---

## 4. 界面需求

### 4.1 主界面布局

```
┌────────────────────────────────────────────────────────────┐
│  DWG智能翻译算量系统                          [-] [□] [×]   │
├────────────────────────────────────────────────────────────┤
│  文件(F)  编辑(E)  视图(V)  翻译(T)  算量(Q)  工具(O)  帮助(H)│
├────────────────────────────────────────────────────────────┤
│  [📁] [💾] [🔍+] [🔍-] [📏] │ [🌐翻译] [📊算量] [📤导出]    │
├────┬───────────────────────────────────────────┬───────────┤
│图层│                                           │  属性面板  │
│面板│                                           │           │
│    │                                           │  [文件]   │
│☑ 0 │                                           │  大小:5.2MB│
│☑墙体│         图纸显示区域                      │  版本:R2018│
│☐门窗│                                           │  实体:1234 │
│☑标注│      [CAD Drawing Preview]               │           │
│☑文字│                                           │  [实体]   │
│    │                                           │  类型:LINE │
│    │                                           │  图层:墙体 │
│    │                                           │  颜色:红色 │
│    │                                           │           │
│    │                                           │  [翻译]   │
│    │                                           │  状态:未翻译│
│    │                                           │  进度: 0%  │
│    │                                           │           │
├────┴───────────────────────────────────────────┴───────────┤
│ 📍 坐标:(125.5, 68.3) | 🔍 100% | 📐 实体数:1234 | ✅ 就绪  │
└────────────────────────────────────────────────────────────┘
```

### 4.2 颜色规范

**浅色主题**:
- 背景色: #FFFFFF
- 文字色: #333333
- 边框色: #DDDDDD
- 主色调: #1890FF (蓝色)
- 成功色: #52C41A (绿色)
- 警告色: #FAAD14 (橙色)
- 错误色: #F5222D (红色)

**深色主题**:
- 背景色: #1A1A1A
- 文字色: #EEEEEE
- 边框色: #444444
- 主色调: #40A9FF
- 成功色: #73D13D
- 警告色: #FFC53D
- 错误色: #FF4D4F

### 4.3 字体规范
- 西文字体: -apple-system, "Segoe UI", Roboto, sans-serif
- 中文字体: "Microsoft YaHei", "PingFang SC", "Noto Sans CJK SC"
- 等宽字体: "Consolas", "Monaco", "Courier New"
- 基准字号: 14px
- 标题字号: 20px / 16px / 14px (H1/H2/H3)

### 4.4 交互规范

**鼠标操作**:
- 单击: 选择实体
- 双击: 编辑文本
- 右键: 弹出上下文菜单
- 滚轮: 缩放
- 中键拖拽: 平移
- 左键拖拽: 框选

**键盘快捷键**:
- Ctrl+O: 打开文件
- Ctrl+S: 保存文件
- Ctrl+Z: 撤销
- Ctrl+Y: 重做
- Ctrl+F: 搜索
- Ctrl+T: 开始翻译
- Ctrl+Q: 开始算量
- Ctrl++: 放大
- Ctrl+-: 缩小
- Ctrl+0: 适应窗口
- F11: 全屏

---

## 5. 数据需求

### 5.1 数据存储

**本地数据库** (SQLite):
```sql
-- 翻译缓存表
CREATE TABLE translation_cache (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    source_text TEXT NOT NULL,
    target_text TEXT NOT NULL,
    source_lang VARCHAR(10),
    target_lang VARCHAR(10),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(source_text, source_lang, target_lang)
);

-- 算量规则表
CREATE TABLE calculation_rules (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL,
    component_type VARCHAR(50),
    formula TEXT,
    unit VARCHAR(20),
    config JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 项目历史表
CREATE TABLE project_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    file_path TEXT NOT NULL,
    file_size INTEGER,
    entity_count INTEGER,
    last_opened TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    thumbnail BLOB
);
```

**配置文件** (TOML):
```toml
# config.toml
[api]
provider = "aliyun-bailian"
endpoint = "https://dashscope.aliyuncs.com/api/v1"
model = "qwen-plus"
timeout = 60
max_retries = 3

[translation]
cache_enabled = true
cache_ttl_days = 7
batch_size = 100

[calculation]
default_waste_factor = 0.03
auto_deduction = true

[ui]
theme = "auto"  # auto | light | dark
language = "zh-CN"
font_size = "medium"
```

### 5.2 数据导入导出

**导出格式**:
1. **翻译对照表** (Excel):
   - 列: 序号、原文、译文、图层、实体类型、坐标
   - 格式: .xlsx

2. **算量清单** (Excel):
   - Sheet1: 汇总表
   - Sheet2: 明细表
   - 格式: .xlsx

3. **算量报表** (HTML):
   - 包含表格、图表
   - 可打印

4. **翻译后图纸**:
   - 格式: DWG / DXF / PDF / SVG

---

## 6. 外部接口需求

### 6.1 阿里云百炼API

**API端点**: `https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation`

**请求格式**:
```json
{
  "model": "qwen-plus",
  "input": {
    "messages": [
      {
        "role": "system",
        "content": "你是一个专业的建筑图纸翻译专家"
      },
      {
        "role": "user",
        "content": "请翻译: 承重墙"
      }
    ]
  },
  "parameters": {
    "temperature": 0.3,
    "max_tokens": 2000
  }
}
```

**响应格式**:
```json
{
  "output": {
    "text": "Load-bearing Wall",
    "finish_reason": "stop"
  },
  "usage": {
    "input_tokens": 25,
    "output_tokens": 8
  },
  "request_id": "fb6c4436-bb64-4676-a838-3f1f252d4b7d"
}
```

**错误处理**:
- HTTP 401: API密钥无效
- HTTP 429: 请求频率超限
- HTTP 500: 服务器错误

---

## 7. 质量属性

### 7.1 准确性
- 翻译准确率: > 95%
- 算量误差率: < 2%
- 实体识别准确率: > 99%

### 7.2 稳定性
- 应用崩溃率: < 0.1%
- 内存泄漏: 无
- 长时间运行稳定

### 7.3 性能
见 NFR-01

---

## 8. 约束条件

### 8.1 技术约束
- 必须使用Tauri 2.0框架
- 必须使用阿里云百炼大模型
- 不得使用GPL授权的第三方库

### 8.2 业务约束
- 单个API密钥每日翻译上限: 100万tokens
- 免费版功能限制: 单次翻译最多1000条文本

### 8.3 法律约束
- 遵守开源软件许可协议
- 不侵犯AutoCAD等商标权
- 遵守数据保护法规

---

## 9. 验收标准

### 9.1 功能验收
- [ ] 所有P0功能100%实现
- [ ] 所有P1功能100%实现
- [ ] P2功能至少实现80%

### 9.2 性能验收
- [ ] 响应时间满足NFR-01
- [ ] 资源占用满足NFR-03
- [ ] 并发测试通过

### 9.3 兼容性验收
- [ ] Windows 10/11测试通过
- [ ] macOS 12+测试通过
- [ ] Ubuntu 20.04+测试通过
- [ ] AutoCAD 2018-2024兼容性测试通过

### 9.4 用户验收
- [ ] 5名目标用户试用反馈良好
- [ ] 用户满意度 > 8/10
- [ ] 无P0/P1级别Bug

---

## 10. 附录

### 10.1 参考文档
- AutoCAD DWG格式规范
- 阿里云百炼API文档
- 建筑工程量计算规范 (GB 50500-2013)

### 10.2 缩略语
- DWG: Drawing (AutoCAD图形文件)
- DXF: Drawing Exchange Format
- API: Application Programming Interface
- OCR: Optical Character Recognition
- UI: User Interface
- UX: User Experience
- MTBF: Mean Time Between Failures

---

**文档结束**
