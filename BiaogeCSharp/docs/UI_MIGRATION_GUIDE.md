# 表哥 C# Avalonia UI 100%还原指南

## 重要说明

Python版本使用 **qfluentwidgets** (Fluent Design for PyQt6)，这是一个完整的组件库。
C# Avalonia版本需要100%还原，包括：
- 视觉外观（颜色、间距、字体）
- 交互逻辑（点击、拖动、快捷键）
- 布局结构（导航栏、卡片、面板）
- 所有功能（一个不能少）

---

## Python版本UI分析

### 主要组件库

| Python (qfluentwidgets) | Avalonia UI 等价实现 |
|------------------------|---------------------|
| `FluentWindow` | 自定义NavigationView |
| `CardWidget` | Border + DropShadowEffect |
| `PrimaryPushButton` | Button (Accent style) |
| `PushButton` | Button (Default style) |
| `InfoBar` | Notification/SnackBar |
| `ComboBox` | ComboBox |
| `LineEdit` | TextBox |
| `SpinBox` | NumericUpDown |
| `CheckBox` | CheckBox |
| `TableWidget` | DataGrid |
| `TextEdit` | TextBox (Multiline) |
| `FluentIcon` | PathIcon/FontIcon |

### 主窗口结构

```
FluentWindow (左侧导航 + 内容区)
├── NavigationBar (左侧，200px宽)
│   ├── 顶部导航项
│   │   ├── 主页 (HOME图标)
│   │   ├── 翻译 (LANGUAGE图标)
│   │   ├── 算量 (CALCULATOR图标)
│   │   ├── 导出 (SAVE图标)
│   │   └── 批量处理 (FOLDER图标)
│   └── 底部导航项
│       ├── 性能监控 (SPEED_HIGH图标)
│       └── AI助手 (ROBOT图标)
├── ContentFrame (右侧内容区)
│   └── 根据选择显示不同界面
└── TitleBar (顶部标题栏)
    ├── 设置按钮 (SETTING图标)
    └── 关于按钮 (INFO图标)
```

---

## 完整功能清单

### 1. 主页界面 (Home Page)

**布局：**
```
┌──────────────────────────────────────┐
│ [打开DWG文件] [智能翻译] [智能算量]  │  <- 快捷按钮栏
├──────────────────────────────────────┤
│                                      │
│          DWG查看器画布                │
│    (支持拖动、缩放、旋转)            │
│                                      │
└──────────────────────────────────────┘
```

**组件：**
- 快捷按钮栏 (10px padding)
- `PrimaryPushButton`: 打开DWG文件
- `PushButton`: 智能翻译 (初始禁用)
- `PushButton`: 智能算量 (初始禁用)
- `DWGCanvas`: Skia渲染画布

**交互逻辑：**
1. 打开文件后启用"智能翻译"和"智能算量"按钮
2. 点击按钮自动切换到对应界面
3. 支持拖放DWG文件到窗口

---

### 2. 翻译界面 (Translation Interface)

**布局：**
```
┌──────────────────────────────────┐
│  图纸翻译                         │  <- TitleLabel
├──────────────────────────────────┤
│  ┌────────────────────────────┐  │
│  │ 源语言: [中文 ▼]           │  │  <- 语言选择卡片
│  │ 目标语言: [英文 ▼]         │  │     (CardWidget)
│  └────────────────────────────┘  │
├──────────────────────────────────┤
│  ┌────────────────────────────┐  │
│  │ [开始翻译]  [停止]         │  │  <- 控制卡片
│  │ ████████████░░░░  80%     │  │     (进度条)
│  │ 正在翻译... (40/50)       │  │     (状态标签)
│  └────────────────────────────┘  │
├──────────────────────────────────┤
│  ┌────────────────────────────┐  │
│  │ 翻译完成！                 │  │  <- 统计卡片
│  │ 总实体数: 1000            │  │     (TextEdit, 只读)
│  │ 唯一文本: 500             │  │
│  │ 缓存命中: 450 (90%)       │  │
│  │ Token消耗: 12000          │  │
│  │ 成本: ¥0.048              │  │
│  └────────────────────────────┘  │
└──────────────────────────────────┘
```

**组件清单：**
- `TitleLabel`: "图纸翻译"
- `CardWidget` #1: 语言选择
  - `BodyLabel`: "源语言:"
  - `ComboBox`: 中文/英文/日文/韩文/德文/法文/西班牙文/俄文
  - `BodyLabel`: "目标语言:"
  - `ComboBox`: 同上
- `CardWidget` #2: 翻译控制
  - `PrimaryPushButton`: "开始翻译" (FluentIcon.SYNC)
  - `PushButton`: "停止" (FluentIcon.CANCEL, 初始禁用)
  - `ProgressBar`: 0-100%进度
  - `BodyLabel`: 状态文本
- `CardWidget` #3: 统计信息
  - `TextEdit`: 只读，显示详细统计

**交互逻辑：**
1. 未加载文档时"开始翻译"禁用
2. 翻译中禁用"开始翻译"，启用"停止"
3. 显示实时进度和状态
4. 翻译完成后显示统计信息
5. 如未配置API密钥，显示错误提示

---

### 3. 算量界面 (Calculation Interface)

**布局：**
```
┌──────────────────────────────────────────────────────┐
│  工程量计算                                           │
├──────────────────────────────────────────────────────┤
│  [识别构件]                                          │
├──────────────────────────────────────────────────────┤
│  验证通过: 所有 45 个构件验证通过                     │  <- 验证状态
├──────────────────────────────────────────────────────┤
│  ┌────┬────┬────┬────┬────┬────┬────────┐           │
│  │类型│数量│体积│面积│费用│状态│置信度  │  <- 表格  │
│  ├────┼────┼────┼────┼────┼────┼────────┤           │
│  │梁  │ 20 │2.5m│120 │¥500│通过│99.99%  │           │
│  │柱  │ 15 │1.8m│ 90 │¥400│通过│99.95%  │           │
│  └────┴────┴────┴────┴────┴────┴────────┘           │
├──────────────────────────────────────────────────────┤
│  工程量统计报告                                       │  <- 报告文本
│  总构件数: 45                                        │     (只读)
│  梁: 20个, 体积: 2.5m³, 成本: ¥500                  │
│  柱: 15个, 体积: 1.8m³, 成本: ¥400                  │
│  ...                                                │
└──────────────────────────────────────────────────────┘
```

**组件清单：**
- `TitleLabel`: "工程量计算"
- `PrimaryPushButton`: "识别构件" (FluentIcon.SEARCH)
- `BodyLabel`: 验证状态 (根据结果改变颜色)
- `TableWidget`: 7列表格
  - 列名：类型、数量、体积、面积、费用、状态、置信度
  - 单元格颜色根据状态变化（绿色=通过，黄色=警告，红色=错误）
- `TextEdit`: 只读报告

**交互逻辑：**
1. 未加载文档时"识别构件"禁用
2. 点击识别后启动识别管道（3种识别器可选）
3. 显示验证结果和置信度
4. 表格单元格根据状态着色
5. 生成详细报告

---

### 4. 导出界面 (Export Interface)

**布局：**
```
┌──────────────────────────────┐
│  导出                         │
├──────────────────────────────┤
│  [导出DWG/DXF]               │
│  [导出PDF]                   │
│  [导出Excel报表]             │
└──────────────────────────────┘
```

**组件清单：**
- `TitleLabel`: "导出"
- `PushButton`: "导出DWG/DXF" (FluentIcon.SAVE)
- `PushButton`: "导出PDF" (FluentIcon.DOCUMENT)
- `PushButton`: "导出Excel报表" (FluentIcon.CHART, 需先算量)

**交互逻辑：**
1. 未加载文档时DWG/PDF按钮禁用
2. 未执行算量时Excel按钮禁用
3. 点击按钮打开保存对话框
4. 导出完成后显示成功通知

---

### 5. 批量处理界面 (Batch Processing)

**布局：**
```
┌──────────────────────────────────────┐
│  批量处理                             │
├──────────────────────────────────────┤
│  [添加文件]  [清空列表]              │
├──────────────────────────────────────┤
│  ┌──────────────────────────────┐    │
│  │ file1.dwg  ✓ 完成            │    │  <- 文件列表
│  │ file2.dwg  ⏳ 处理中         │    │
│  │ file3.dwg  ⏸ 等待            │    │
│  └──────────────────────────────┘    │
├──────────────────────────────────────┤
│  [开始批量处理]                       │
│  ████████░░░░░░  60% (2/5)          │
└──────────────────────────────────────┘
```

---

### 6. 性能监控界面 (Performance Panel)

**布局：**
```
┌──────────────────────────────────┐
│  性能监控                         │
├──────────────────────────────────┤
│  CPU使用率: 25%   📈              │
│  内存使用: 150MB / 500MB  📊     │
│  渲染帧率: 60 FPS  🎮            │
│  实体数量: 50,000  📐            │
├──────────────────────────────────┤
│  [清除统计]  [导出报告]          │
└──────────────────────────────────┘
```

---

### 7. AI助手界面 (AI Assistant)

**布局：**
```
┌──────────────────────────────────┐
│  🤖 AI助手                       │
├──────────────────────────────────┤
│  ┌────────────────────────────┐  │
│  │ 用户: 帮我翻译这个图纸      │  │  <- 聊天历史
│  │ AI: 好的，我来帮你...      │  │
│  │ 用户: 识别一下梁柱          │  │
│  │ AI: 已识别到20个梁...      │  │
│  └────────────────────────────┘  │
├──────────────────────────────────┤
│  [输入消息...]        [发送]     │  <- 输入框
└──────────────────────────────────┘
```

---

### 8. 设置对话框 (Settings Dialog) - 6个选项卡

#### 选项卡1: 阿里云百炼

```
┌──────────────────────────────────────────┐
│  ┌────────────────────────────────────┐  │
│  │ API密钥: [●●●●●●●●●●●●] [👁]       │  │  <- 密码输入框 + 显示按钮
│  │ 点击获取API密钥 | 密钥安全保存本地  │  │  <- 帮助链接
│  │ API端点: [https://dashscope...]   │  │
│  │ 请求超时: [30 秒]                  │  │
│  │ 重试次数: [3 次]                   │  │
│  └────────────────────────────────────┘  │
│  ┌────────────────────────────────────┐  │
│  │ 多模态模型:                         │  │  <- 模型配置
│  │ [qwen-vl-max ▼] ¥0.020/1K tokens  │  │
│  │ 图片翻译:                          │  │
│  │ [qwen-vl-max ▼] ¥0.020/1K tokens  │  │
│  │ 文本翻译:                          │  │
│  │ [qwen-mt-plus ▼] ¥0.006/1K tokens │  │
│  │ ☐ 使用自定义模型                   │  │
│  │ 自定义模型: [qwen-max-0428]       │  │  <- 初始禁用
│  └────────────────────────────────────┘  │
│                 [测试连接]                │
└──────────────────────────────────────────┘
```

#### 选项卡2: 翻译设置

```
┌──────────────────────────────────────────┐
│  批量翻译大小: [50 条/批]                 │
│  并发翻译线程: [3 个线程]                 │
├──────────────────────────────────────────┤
│  ☑ 启用翻译缓存（可节省90%+成本）         │
│  缓存有效期: [30 天]                     │
│  ☑ 自动清理过期缓存                       │
├──────────────────────────────────────────┤
│  上下文窗口: [3 条]                       │
│  ☑ 使用专业术语库                         │
│  ☑ 启用后处理优化                         │
├──────────────────────────────────────────┤
│  默认源语言: [自动检测 ▼]                │
│  默认目标语言: [英文 ▼]                   │
└──────────────────────────────────────────┘
```

#### 选项卡3: 性能优化

```
┌──────────────────────────────────────────┐
│  ☑ 启用空间索引（R-tree）                 │
│  ☑ 启用抗锯齿                             │
│  实体阈值: [100]                         │
├──────────────────────────────────────────┤
│  FPS限制: [60]                           │
│  内存阈值: [500 MB]                      │
│  ☑ 启用自动优化                           │
├──────────────────────────────────────────┤
│  缓存大小: [100 MB]                      │
├──────────────────────────────────────────┤
│  ☑ 启用性能监控                           │
│  ☑ 保留历史记录                           │
│  ☑ 生成性能报告                           │
└──────────────────────────────────────────┘
```

#### 选项卡4: 界面设置

```
┌──────────────────────────────────────────┐
│  主题: [深色 ▼]                          │
│  (选项: 浅色/深色/系统/蓝色/绿色)        │
│  语言: [简体中文 ▼]                      │
│  字体大小: [中等 ▼]                      │
├──────────────────────────────────────────┤
│  ☑ 启用动画效果                           │
│  ☑ 显示提示信息                           │
│  ☑ 启用快捷键                             │
├──────────────────────────────────────────┤
│  窗口透明度: [90%]  ━━━━━━━●━━          │
└──────────────────────────────────────────┘
```

#### 选项卡5: 数据管理

```
┌──────────────────────────────────────────┐
│  配置目录: [~/.biaoge/config]  [浏览]    │
│  缓存目录: [~/.biaoge/cache]   [浏览]    │
│  日志目录: [~/.biaoge/logs]    [浏览]    │
├──────────────────────────────────────────┤
│  [导出配置]  [导入配置]                   │
│  [清空缓存]  [清空日志]                   │
│  [备份数据]  [恢复数据]                   │
└──────────────────────────────────────────┘
```

#### 选项卡6: 高级

```
┌──────────────────────────────────────────┐
│  ☐ 启用调试模式                           │
│  ☐ 详细日志记录                           │
│  ☐ 性能分析                               │
├──────────────────────────────────────────┤
│  日志级别: [INFO ▼]                       │
│  (选项: DEBUG/INFO/WARNING/ERROR)        │
├──────────────────────────────────────────┤
│  [恢复默认设置]                           │
└──────────────────────────────────────────┘
```

---

## 样式规范

### 颜色方案 (Dark Theme)

```csharp
// 主题颜色
Background = #1E1E1E (深灰)
Surface = #2D2D30 (卡片背景)
Primary = #0078D4 (蓝色强调)
OnSurface = #FFFFFF (白色文本)
OnSurfaceVariant = #999999 (灰色次要文本)

// 状态颜色
Success = #107C10 (绿色)
Warning = #FF8C00 (橙色)
Error = #E81123 (红色)
Info = #0078D4 (蓝色)

// 边框
BorderBrush = #3E3E42
```

### 间距规范

```csharp
// 边距
Margin:
  - 小: 5px
  - 中: 10px
  - 大: 20px

// 内边距
Padding:
  - 卡片: 20px
  - 按钮: 10px 20px
  - 输入框: 8px 12px

// 间隔
Spacing:
  - 表单: 15px
  - 按钮组: 10px
  - 卡片间: 20px
```

### 字体规范

```csharp
TitleLabel: 24px, SemiBold
SubtitleLabel: 18px, SemiBold
BodyLabel: 14px, Normal
CaptionLabel: 12px, Normal
```

### 圆角规范

```csharp
CardWidget: 8px
Button: 4px
Input: 4px
Dialog: 8px
```

---

## 通知系统 (InfoBar)

```csharp
// 成功通知
InfoBar.success(
    title: "成功",
    content: "操作成功！",
    duration: 2000ms,
    position: TopRight
);

// 警告通知
InfoBar.warning(
    title: "警告",
    content: "请注意...",
    duration: 3000ms,
    position: Top
);

// 错误通知
InfoBar.error(
    title: "错误",
    content: "操作失败",
    duration: 4000ms,
    position: Top
);

// 信息通知
InfoBar.info(
    title: "提示",
    content: "正在处理...",
    duration: 1000ms,
    position: TopRight
);
```

---

## 交互动画

```csharp
// 按钮悬停
Hover:
  - Scale: 1.02
  - Duration: 100ms
  - Easing: EaseOut

// 卡片展开
Expand:
  - Height: 0 -> Auto
  - Duration: 200ms
  - Easing: EaseInOut

// 通知出现
Notification:
  - Slide from Right
  - Duration: 300ms
  - Easing: EaseOut
```

---

## 快捷键

```csharp
Ctrl+O: 打开文件
Ctrl+S: 保存
Ctrl+E: 导出
Ctrl+T: 翻译
Ctrl+Q: 算量
Ctrl+,: 设置
F1: 帮助
F5: 刷新
Esc: 关闭对话框
```

---

## 拖放支持

```csharp
// 主窗口支持拖放DWG文件
AllowDrop = true
OnDrop:
  - 验证文件类型 (.dwg, .dxf)
  - 自动打开文件
  - 显示加载进度
```

---

## 测试清单

### 视觉测试
- [ ] 所有界面与Python版本像素级一致
- [ ] 颜色方案完全匹配
- [ ] 间距和对齐完全一致
- [ ] 字体大小和粗细一致
- [ ] 图标样式一致

### 功能测试
- [ ] 所有按钮点击响应正确
- [ ] 所有输入框验证正确
- [ ] 所有下拉框选项完整
- [ ] 所有对话框显示正确
- [ ] 所有通知提示正确

### 交互测试
- [ ] 拖放文件正常
- [ ] 快捷键全部工作
- [ ] 动画效果流畅
- [ ] 响应式布局正确
- [ ] 焦点导航正确

### 性能测试
- [ ] 启动时间 < 1s
- [ ] 界面切换 < 100ms
- [ ] 文件加载流畅
- [ ] 内存占用正常

---

## 实施优先级

### P0 (必须完成)
1. FluentWindow导航栏
2. 主页 + DWG查看器
3. 翻译界面
4. 算量界面
5. 导出界面
6. 设置对话框（6选项卡）

### P1 (高优先级)
7. 性能监控
8. 批量处理
9. AI助手

### P2 (中优先级)
10. 日志查看器
11. 关于对话框
12. 欢迎对话框

---

## 下一步行动

1. **安装Avalonia Fluent Theme**
2. **创建自定义NavigationView组件** (模拟FluentWindow)
3. **实现CardWidget样式** (Border + Shadow)
4. **实现通知系统** (InfoBar)
5. **逐个界面1:1重构**

---

**文档版本**: 1.0
**创建日期**: 2025-11-09
**作者**: Claude Code
**状态**: 完整UI规范 - 待实施
